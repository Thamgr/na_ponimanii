# На понимании (Na Ponimanii)

## Telegram Bot с FastAPI интеграцией

Этот проект представляет собой интеграцию Telegram-бота с FastAPI сервером. Бот пересылает все входящие сообщения на FastAPI сервер, который обрабатывает их и отправляет ответ обратно пользователю через Telegram Bot API.

### Установка и запуск

#### Получение токена от BotFather

1. Откройте Telegram и найдите [@BotFather](https://t.me/BotFather)
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания нового бота:
   - Введите имя бота (например, "На понимании Бот")
   - Введите username для бота (должен заканчиваться на "bot", например, "na_ponimanii_bot")
4. После успешного создания BotFather выдаст вам токен, который выглядит примерно так: `1234567890:ABCDefGhIJKlmNoPQRsTUVwxyZ`
5. Сохраните этот токен, он понадобится для запуска бота

#### Настройка проекта

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Откройте файл `config.py` и замените значение переменной `TOKEN` на полученный от BotFather токен:
```python
TOKEN = "ВАШ_ТОКЕН_ЗДЕСЬ"
```

Примечание: Файл `config.py` добавлен в `.gitignore`, поэтому ваш токен не будет отправлен в репозиторий при пуше на GitHub.

#### Запуск приложения

1. Запустите FastAPI сервер:
```bash
python app.py
```

2. В отдельном терминале запустите Telegram бота:
```bash
python telegram_bot.py
```

После запуска бот будет пересылать все входящие сообщения на FastAPI сервер, который будет отвечать пользователю фразой "Получено: <текст сообщения>".

### Конфигурация через переменные окружения

Вы можете настроить приложение, используя следующие переменные окружения:

- `TELEGRAM_TOKEN` - токен вашего Telegram бота
- `API_HOST` - хост для FastAPI сервера (по умолчанию "0.0.0.0")
- `API_PORT` - порт для FastAPI сервера (по умолчанию 8000)

Для удобства вы можете создать файл `.env` в корне проекта и указать в нем переменные окружения:

```
TELEGRAM_TOKEN=ваш_токен_здесь
API_HOST=127.0.0.1
API_PORT=8000
```

### Дальнейшее развитие

В будущем планируется добавить:
- Сохранение тем пользователя в базе данных SQLite
- Интеграция с LLM для генерации более сложных ответов
- Добавление дополнительных команд и функциональности

### База данных

Проект использует SQLAlchemy ORM для работы с базой данных SQLite. База данных хранит информацию о темах, которые пользователи хотят изучить.

#### Структура базы данных

- Таблица `topics`:
  - `id` - первичный ключ, автоинкрементный
  - `user_id` - ID пользователя Telegram
  - `title` - название темы
  - `created_at` - время создания записи

#### Использование базы данных

Для инициализации базы данных выполните:

```bash
python database.py
```

#### API для работы с базой данных

В модуле `database.py` реализованы следующие функции:

- `init_db()` - инициализация базы данных (создание таблиц)
- `add_topic(user_id: int, title: str)` - добавление новой темы
- `list_topics(user_id: int)` - получение списка тем пользователя
- Расширение функциональности FastAPI сервера
